modules = ["python-3.10"]
[nix]
channel = "stable-25_05"
from flask import Flask, request
from twilio.twiml.voice_response import VoiceResponse
import openai

app = Flask(__name__)

# Your OpenAI API Key
openai.api_key = "YOUR_OPENAI_API_KEY"

@app.route("/voice", methods=["POST"])
def voice():
    response = VoiceResponse()
    response.say("Hi there. Tell me what you're looking for after the beep.")
    response.record(
        max_length=8,
        action="/process",
        transcribe=True
    )
    return str(response)

@app.route("/process", methods=["POST"])
def process():
    transcription = request.form.get("TranscriptionText", "")
    ai_response = "Sorry, I didnâ€™t catch that."

    if transcription:
        completion = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "You are a helpful assistant."},
                {"role": "user", "content": transcription}
            ]
        )
        ai_response = completion.choices[0].message.content

    response = VoiceResponse()
    response.say(ai_response)
    return str(response)

app.run(host="0.0.0.0", port=81)
